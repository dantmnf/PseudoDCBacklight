# 伪 DC 调光

[English](README.md) | [下载最新版本](https://github.com/dantmnf/PseudoDCDimming/releases/latest)

## 背景

当前的 OLED 屏幕具有独立的亮度控制输入，用于控制在最高信号电平输入下的亮度。因此，如果我们想要显示亮度为 20 cd/m<sup>2</sup> 的白色，以下两种方式都可以实现：

  1. 调整亮度控制输入，使信号输入电平最高时的亮度为 20 cd/m<sup>2</sup>，然后输入最高电平信号（“白色”）；
  2. 在当前具有更高的亮度控制输入时，比如 160 cd/m<sup>2</sup>，输入一个较低的信号电平（“灰色”），产生 12.5% 最高亮度（20 cd/m<sup>2</sup>）的输出。 

部分 OLED 屏幕在第二种工作情况下会使用更高的 PWM 频率/占空比，一些用户认为这有助于减轻长时间或在黑暗环境下观看屏幕时的不适感。

信号电平与输出亮度之间不是线性关系，因此，第二种方式并不是简单的将输入信号乘以一个系数。但基于以下前提，我们可以实现精确的控制：

  1. Android 系统假定屏幕具有 sRGB 响应曲线；
  2. 基于 sRGB 响应曲线，系统框架及 HAL 提供在线性空间中的 RGB 矩阵变换；
  3. 自 Android 12 开始，系统框架及 HAL 接口支持以 cd/m<sup>2</sup>（或称为 nits）为单位的绝对亮度控制。

## 原理

通过限制亮度控制的最小值，并通过矩阵变换功能缩小输出信号，使实际显示亮度匹配预期亮度，同时保持较高的 PWM 频率/占空比。

## 限制

* 严重依赖厂商对屏幕亮度控制以及响应曲线的校准。如果厂商在校准时使用了不同的响应曲线，或者亮度控制存在非线性行为，都可能影响开启模块后的显示质量；
* 可能与其他颜色变换功能冲突；
* 可能与 HDR 显示冲突。

## 配置

通过相机的高速快门模式放大频闪效应，或使用专业仪器测量 PWM 频率及占空比，选择一个可以接受的亮度值作为最小硬件亮度。
